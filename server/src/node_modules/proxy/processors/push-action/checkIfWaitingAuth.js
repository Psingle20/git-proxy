const Step = require('proxy/actions').Step;
const data = require('data')

const exec = (req, action) => {
  const step = new Step('checkIfWaitingAuth');
  
  try {
    
    existingAction = data.getPush(action.id)
    
    if (existingAction) {
      action = existingAction;

      console.log("--------- EXISTING ACTION FOUND ")
      if (!(existingAction.blocked || existingAction.error)) {              
        console.log("*** ALLOWED TO PUSH ******")
        action = existingAction;
        action.setAllowPush();
      }
    } 

    action.addStep(step);
    return action;    
  }
  catch(e) {
    console.log("--------- ERRROR ")
    console.log(action);
    step.setError(e.message);
    action.addStep(step);
    return action;
  }
};

exec.displayName = 'checkIfWaitingAuth.exec';
exports.exec = exec;

