const Step = require('proxy/actions').Step;
const data = require('data')

const exec = (req, action) => {
  const step = new Step('checkIfWaitingAuth');
  
  try {
    
    existingAction = data.getPush(action.id)
    
    if (existingAction) {      
      console.log("--------- EXISTING ACTION FOUND ---------")
      
      if (existingAction.blocked) {
        action = existingAction;                
      }
      
      if (existingAction.authorised) {              
        console.log("*** authorised ***")        
        action = existingAction;
        action.setAllowPush()
      } 
    } 

    action.addStep(step);
    return action;    
  }
  catch(e) {
    console.log("--------- ERRROR ")
    console.log(action);
    step.setError(e.message);
    action.addStep(step);
    return action;
  }
};

exec.displayName = 'checkIfWaitingAuth.exec';
exports.exec = exec;

