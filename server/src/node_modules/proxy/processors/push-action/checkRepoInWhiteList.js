const config = require('config');
const Step = require('proxy/actions').Step;

const exec = (req, action, whiteList=config.getWhiteList) => {
  
  const step = new Step('checkRepoInWhiteList')
  
  if (!whiteList().includes(action.repo)) {
    step.error = true;
    step.log(`repo ${action.repo} is not in the whitelist, ending`);
    step.setError(true, `Rejecting repo ${action.repo} not in the whitelist`);
  } else {
    step.log(`repo ${action.repo} is in the whitelist`);
  }

  action.addStep(step);

  return action;
};

exec.displayName = 'checkRepoInWhiteList.exec';

exports.exec = exec
